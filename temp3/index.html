<!DOCTYPE html>
<html>

<head>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='icon' href='data:,'>
    <!-- // Es folgen der CSS-Code um die Ein/Aus Buttons zu gestalten -->
    <!-- // Hier können Sie die Hintergrundfarge (background-color) und Schriftgröße (font-size) anpassen -->
    <link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css'
        integrity='sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk' crossorigin='anonymous'>
    <style>
        html {
            font-family: Helvetica;
            display: inline-block;
            margin: 0px auto;
            text-align: center;
        }
        .button {
            background-color: #333344;
            border: none;
            color: white;
            padding: 16px 40px;
            text-decoration: none;
            font-size: 30px;
            margin: 2px;
            cursor: pointer;
        }
        .button2 {
            background-color: #888899;
        }
    </style>
</head>

<!-- // Webseiten-Überschrift -->

<body class='bg-transparent'>
    <section id='navigation'>
        <nav class='navbar navbar-expand-lg navbar-dark bg-dark text-light'>
            <svg width='2em' height='2em' viewBox='0 0 16 16' class='bi bi-hand-thumbs-up m-4' fill='currentColor'
                xmlns='http://www.w3.org/2000/svg'>
                <path fill-rule='evenodd'
                    d='M6.956 1.745C7.021.81 7.908.087 8.864.325l.261.066c.463.116.874.456 1.012.965.22.816.533 2.511.062 4.51a9.84 9.84 0 0 1 .443-.051c.713-.065 1.669-.072 2.516.21.518.173.994.681 1.2 1.273.184.532.16 1.162-.234 1.733.058.119.103.242.138.363.077.27.113.567.113.856 0 .289-.036.586-.113.856-.039.135-.09.273-.16.404.169.387.107.819-.003 1.148a3.163 3.163 0 0 1-.488.901c.054.152.076.312.076.465 0 .305-.089.625-.253.912C13.1 15.522 12.437 16 11.5 16v-1c.563 0 .901-.272 1.066-.56a.865.865 0 0 0 .121-.416c0-.12-.035-.165-.04-.17l-.354-.354.353-.354c.202-.201.407-.511.505-.804.104-.312.043-.441-.005-.488l-.353-.354.353-.354c.043-.042.105-.14.154-.315.048-.167.075-.37.075-.581 0-.211-.027-.414-.075-.581-.05-.174-.111-.273-.154-.315L12.793 9l.353-.354c.353-.352.373-.713.267-1.02-.122-.35-.396-.593-.571-.652-.653-.217-1.447-.224-2.11-.164a8.907 8.907 0 0 0-1.094.171l-.014.003-.003.001a.5.5 0 0 1-.595-.643 8.34 8.34 0 0 0 .145-4.726c-.03-.111-.128-.215-.288-.255l-.262-.065c-.306-.077-.642.156-.667.518-.075 1.082-.239 2.15-.482 2.85-.174.502-.603 1.268-1.238 1.977-.637.712-1.519 1.41-2.614 1.708-.394.108-.62.396-.62.65v4.002c0 .26.22.515.553.55 1.293.137 1.936.53 2.491.868l.04.025c.27.164.495.296.776.393.277.095.63.163 1.14.163h3.5v1H8c-.605 0-1.07-.081-1.466-.218a4.82 4.82 0 0 1-.97-.484l-.048-.03c-.504-.307-.999-.609-2.068-.722C2.682 14.464 2 13.846 2 13V9c0-.85.685-1.432 1.357-1.615.849-.232 1.574-.787 2.132-1.41.56-.627.914-1.28 1.039-1.639.199-.575.356-1.539.428-2.59z' />
            </svg>
            <a class='navbar-brand' href='#'>
                <h1 class='text-monospace'>knitting machine</h1>
            </a>
            <button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#navbarNav'
                aria-controls='navbarNav' aria-expanded='false' aria-label='Toggle navigation'>
                <span class='navbar-toggler-icon'></span>
            </button>
            <div class='collapse navbar-collapse' id='navbarNav'>
                <ul class='navbar-nav'>
                    <li class='nav-item active'>
                        <a class='nav-link' href='#'>Home <span class='sr-only'>(current)</span></a>
                    </li>
                    <li class='nav-item'>
                        <a class='nav-link' href='designs.html'>Designs</a>
                    </li>
                    <li class='nav-item'>
                        <a class='nav-link' href='#'>History</a>
                    </li>
                </ul>
            </div>
        </nav>
    </section>
    <section id='header'>
        <div class='container-fluid'>
            <div class='row mb-4'>
                <div class='col-10 align-self-start'>
                    <h5 class='m-4'>GUI Home</h5>
                </div>
                <div class='col d-inline-block'>
                    <p class='m-4'>machine-state: <span id="machine-state">online</span></p>
                </div>
            </div>
        </div>
    </section>
    <hr/>
    <section id='body'>
        <div class='container mb-4'>
            <div class='row justify-content-center mb-4'>                
                <div class='col-6 input-group'>
                      <select class='custom-select' id='inputGroupSelect04' aria-label='Example select with button addon'>
                      <option selected>Choose Design</option>
                      <option value='1'>1</option>
                      <option value='2'>2</option>
                      <option value='3'>3 </option>
                    </select>
                    <div class='input-group-append'>
                      <button class='btn btn-outline-secondary' type='button'>Button</button>
                    </div>
                  </div>
            </div>
            <hr/>
            <div class='row justify-content-center'>
                <div class='col-4'>
                    <p>GPIO 5 - State ' + output5State + '</p>
                </div>
                <div class='col-2'>
                    <p><a href='/5/on'><button class='btn btn-danger btn-lg'>OFF</button></a></p>
                </div>
            </div>
            <hr/>
            <div class='row justify-content-center'>
                <div class='col-4'>
                    <p>GPIO 4 - State ' + output4State + '</p>
                </div>
                <!-- // Wenn output4State = off, zeige den EIN Button -->
                <!-- if (output4State=='off') { -->
                <div class='col-2'>
                    <p><a href='/4/on'><button class='btn btn-danger btn-lg'>OFF</button></a></p>
                </div>
            </div>

            <hr/>
            <div class='row justify-content-center'>
                <div class='col-2'>
                    <h5>LED Control</h5>
                </div>                          
                <div class='col-2'>
                    <canvas id='led' width='50' height='50'></canvas>
                </div>
                <div class='col-2'>
                    <button class='btn btn-primary btn-lg' id='toggleButton' onclick='onPress()' disabled>Toggle LED</button>
                </div>                     
            </div> 
        </div>
    </section>

    <section>
               
    </section>

    <section id='my-footer'>
        <div class='container-fluid fixed-bottom'>
            <div class='row d-flex justify-content-center bg-secondary'>
                <div class='col-4'>
                    <p class='text-alert text-center m-auto'>2020</p>
                </div>
            </div>
        </div>
    </section>

    <!-- } else {
    <p><a href='/4/off'><button class='btn btn-success btn-lg'>ON</button></a></p>
    }
 -->

    </div>

    <script src='https://code.jquery.com/jquery-3.5.1.slim.min.js'
        integrity='sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj' crossorigin='anonymous'>
    </script>
    <script src='https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js'
        integrity='sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo' crossorigin='anonymous'>
    </script>
    <script src='https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js'
        integrity='sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI' crossorigin='anonymous'>
    </script>
    <script language='javascript' type='text/javascript'>

        var url = "ws://192.168.0.197:1337/";
        var output;
        var button;
        var canvas;
        var context;
        var machineState;
        
        // This is called when the page finishes loading
        function init() {
        
            // Assign page elements to variables
            button = document.getElementById("toggleButton");
            output = document.getElementById("output");
            canvas = document.getElementById("led");
            machineState = document.getElementById("machine-state");
            
            // Draw circle in canvas
            context = canvas.getContext("2d");
            context.arc(25, 25, 15, 0, Math.PI * 2, false);
            context.lineWidth = 3;
            context.strokeStyle = "black";
            context.stroke();
            context.fillStyle = "black";
            context.fill();

            machineState.style.color = 'red';
            
            // Connect to WebSocket server
            wsConnect(url);
        }
        
        // Call this to connect to the WebSocket server
        function wsConnect(url) {
            
            // Connect to WebSocket server
            websocket = new WebSocket(url);
            
            // Assign callbacks
            websocket.onopen = function(evt) { onOpen(evt) };
            websocket.onclose = function(evt) { onClose(evt) };
            websocket.onmessage = function(evt) { onMessage(evt) };
            websocket.onerror = function(evt) { onError(evt) };
        }
        
        // Called when a WebSocket connection is established with the server
        function onOpen(evt) {
        
            // Log connection state
            console.log("Connected");
            
            // Enable button
            button.disabled = false;
            
            // Get the current state of the LED
            doSend("getLEDState");

            machineState.style.color = 'green';
        }
        
        // Called when the WebSocket connection is closed
        function onClose(evt) {
        
            // Log disconnection state
            console.log("Disconnected");
            
            // Disable button
            button.disabled = true;
            machineState.style.color = 'red';
            
            // Try to reconnect after a few seconds
            setTimeout(function() { wsConnect(url) }, 2000);
        }
        
        // Called when a message is received from the server
        function onMessage(evt) {
        
            // Print out our received message
            console.log("Received: " + evt.data);
            
            // Update circle graphic with LED state
            switch(evt.data) {
                case "0":
                    console.log("LED is off");
                    context.fillStyle = "black";
                    context.fill();
                    break;
                case "1":
                    console.log("LED is on");
                    context.fillStyle = "red";
                    context.fill();
                    break;
                default:
                    break;
            }
        }
        
        // Called when a WebSocket error occurs
        function onError(evt) {
            console.log("ERROR: " + evt.data);
        }
        
        // Sends a message to the server (and prints it to the console)
        function doSend(message) {
            console.log("Sending: " + message);
            websocket.send(message);
        }
        
        // Called whenever the HTML button is pressed
        function onPress() {
            doSend("toggleLED");
            doSend("getLEDState");
        }
        
        // Call the init function as soon as the page loads
        window.addEventListener("load", init, false);
        
        </script>        
        
</body>

</html>
